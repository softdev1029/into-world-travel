/**
 * @package     ZOOlanders
 * @version     3.3.27
 * @author      ZOOlanders - http://zoolanders.com
 * @license     GNU General Public License v2 or later
 */

!function(e,a,t,n){"use strict";var l=function(){};e.extend(l.prototype,e.zlux.Manager.prototype,{name:"itemsManager",options:{apps:"",types:"",categories:"",tags:"",authors:""},initialize:function(a){this.options=e.extend({},this.options,a);var t=this;t.filter={},t.initCheck(),t.itemsmanager=e('<div class="zl-bootstrap zlux-itemsmanager" />').appendTo(t.element),t.initDataTable(t.itemsmanager)},initCheck:function(){var a=this;e.zlux.itemsManager.iNextUnique++,a.ID=e.zlux.itemsManager.iNextUnique},initDataTable:function(a){var t=this;e.zlux.assets.load(e.zlux.url.zlfw("zlux/assets/datatables/dataTables.with.plugins.min.js"),function(){t._initDataTable(a)})},_initDataTable:function(a){var t=this;e('<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" />').appendTo(a),t.oTable=e("table",a).dataTable({sDom:"F<'row-fluid'<'span12't>><'row-fluid'<'span12'p>><'row-fluid zlux-x-info'<'span12'i>>",bServerSide:!0,iDisplayLength:20,sAjaxSource:e.zlux.url.ajax("zlux","getItemsManagerData"),sServerMethod:"POST",fnServerParams:function(e){var a=t.filter.apps?t.filter.apps:t.options.apps,n=t.filter.types?t.filter.types:t.options.types,l=t.filter.cats?t.filter.cats:t.options.categories,i=t.filter.tags?t.filter.tags:t.options.tags,o=(t.filter.authors?t.filter.authors:t.options.authors,t.options.hide_unpublished);e.push({name:"apps",value:t.options.apps}),e.push({name:"types",value:t.options.types}),e.push({name:"categories",value:t.options.categories}),e.push({name:"tags",value:t.options.tags}),e.push({name:"authors",value:t.options.authors}),e.push({name:"filter_apps",value:a}),e.push({name:"filter_types",value:n}),e.push({name:"filter_cats",value:l}),e.push({name:"filter_tags",value:i}),e.push({name:"hide_unpublished",value:o})},oLanguage:{sEmptyTable:t._("IM_NO_ITEMS_FOUND"),sInfoEmpty:"",sInfo:t._("IM_PAGINATION_INFO")},aoColumns:[{sTitle:t._("NAME"),mData:"_itemname",sClass:"column-name",mRender:function(e,a){return"display"===a?"":e},fnCreatedCell:function(a,t,n){e(a).parent("tr").attr("data-id",n.id)}},{sTitle:"App",mData:"application",bSortable:!1,mRender:function(e,a){return"display"===a?e.name:e.id}},{sTitle:"Type",mData:"type",bSortable:!1,mRender:function(e,a){return"display"===a?e.name:e.id}},{sTitle:"Access",mData:"access",bSearchable:!1,bSortable:!1},{sTitle:"Author",mData:"author",bSearchable:!1,bSortable:!1,mRender:function(e,a){return"display"===a?e.name:e.id}},{sTitle:"ID",mData:"id",bSearchable:!1,bSortable:!1},{sTitle:"",mData:"type",bSortable:!1,bSearchable:!1,sWidth:"14px",sClass:"column-icon",mRender:function(e,a){return"display"===a?'<i class="icon-file-alt"></i>':e}}],aoColumnDefs:[{bVisible:!1,aTargets:[1,2,3,4,5]}],fnInitComplete:function(){var n=e(".zlux-x-filter-input_wrapper",a).append(e('<i class="icon-search" />'),e('<i class="icon-remove zlux-ui-dropdown-unselect" />').hide().on("click",function(){e("input",n).val(""),e(this).hide(),t.oTable.fnFilter("")}));e("input",n).on("keyup",function(){""===e(this).val()?e(".zlux-ui-dropdown-unselect",n).hide():e(".zlux-ui-dropdown-unselect",n).show()}),e("thead tr th:last",t.oTable).prependTo(e("thead tr",t.oTable)),t.trigger("InitComplete")},fnRowCallback:function(a,n){var l=n;l.dom=e(a),l.dom.addClass("zlux-object"),e("td:last",l.dom).prependTo(l.dom),e(".column-name",l.dom).html("").removeClass("zlux-ui-open").append(t.renderObjectDOM(l))},fnPreDrawCallback:function(e){t.zluxdialog.spinner("show"),t.trigger("DTPreDrawCallback",e)},fnDrawCallback:function(a){var n=a.oInstance.fnPagingInfo(),l=e(".dataTables_paginate",e(a.nTableWrapper)).closest(".row-fluid");n.iTotalPages<=1?l.hide():l.show(),t.zluxdialog.scrollbar("refresh"),t.zluxdialog.spinner("hide"),t.trigger("TableDrawCallback",a)}}).on("click",".zlux-object .zlux-x-name a",function(){var a=e(this).closest("tr.zlux-object"),n=t.oTable.fnGetData(a[0]);return n.dom=a,t.trigger("ObjectSelected",n),!1})},renderObjectDOM:function(a){var t,n=this;t=[{name:n._("ROUTE"),value:a.application.name+" / "+a.type.name+" / ID "+a.id},{name:n._("ACCESS"),value:a.access},{name:n._("CREATED"),value:a.created}],a.author.name&&t.push({name:n._("AUTHOR"),value:a.author.name});var l="";return e.each(t,function(e,a){l+="<li><strong>"+a.name+"</strong>: <span>"+a.value+"</span></li>"}),e('<div class="zlux-x-tools"><i class="zlux-x-details-btn icon-angle-down" /></div><div class="zlux-x-name"><a href="#" class="zlux-x-name-link">'+a.name+'</a></div><div class="zlux-x-details"><div class="zlux-x-messages" /><div class="zlux-x-details-content"><ul class="unstyled">'+l+"</ul></div></div>")},reload:function(){this.oTable.fnReloadAjax()}}),e.zlux[l.prototype.name]=l,e.zlux[l.prototype.name].iNextUnique=0}(jQuery,window,document),function(e,a,t,n){"use strict";var l=function(a,t){var n=this;e(a).data(l.prototype.name)||(n.element=e(a),n.options=e.extend({},l.prototype.options,e.zlux.itemsManager.prototype.options,t),this.events={},n.initialize(),n.element.data(l.prototype.name,n))};e.extend(l.prototype,e.zlux.itemsManager.prototype,{name:"itemsDialogManager",options:{title:"Items Manager",position:{},full_mode:0,dialogClass:""},initialize:function(e){var a=this;a.initCheck(),a.filter={},a.element.on("click",function(){return a.zluxdialog.toggle(),!1}),a.initDialog(),a.initMainEvents()},initDialog:function(){var a=this;a.options.dialogClass="zl-bootstrap zlux-itemsmanager"+(a.options.full_mode?" zlux-dialog-full ":"")+(a.options.dialogClass?" "+a.options.dialogClass:""),e.zlux.assets.load("dialog").done(function(){a.zluxdialog=e.zlux.dialog({title:a.options.title,width:a.options.full_mode?"75%":300,dialogClass:a.options.dialogClass,position:e.extend({of:a.element,my:"left top",at:"right bottom"},a.options.position)}).bind("InitComplete",function(){a.zluxdialog.widget.attr("id","zluxItemsManager_"+a.ID),a.eventDialogLoaded()})})},eventDialogLoaded:function(){var a=this;a.itemsmanager=e('<div class="zlux-itemsmanager" />').appendTo(a.zluxdialog.content),a.initDataTable(a.itemsmanager),a.zluxdialog.main.on("click",".zlux-x-details-btn",function(){var t=e(this),n=t.closest("tr.zlux-object"),l=e("td.column-name",n),i=e(".zlux-x-details",n);l.hasClass("zlux-ui-open")?(t.addClass("icon-angle-down").removeClass("icon-angle-up"),l.removeClass("zlux-ui-open"),i.slideUp("fast",function(){a.zluxdialog.scrollbar("refresh")})):(l.addClass("zlux-ui-open"),t.removeClass("icon-angle-down").addClass("icon-angle-up"),a.zluxdialog.content.stop().animate({scrollTop:n.get(0).offsetTop},900,"swing"),i.slideDown("fast",function(){a.zluxdialog.scrollbar("refresh")}))}),e("html").on("mousedown",function(e){!a.zluxdialog.dialog("isOpen")||a.element.is(e.target)||a.element.find(e.target).length||a.zluxdialog.widget.find(e.target).length||a.zluxdialog.widget.is(e.target)||a.zluxdialog.dialog("close")}),a.zluxdialog.setMainToolbar([{title:a._("APPLY_FILTERS"),icon:"filter",click:function(t){e(".zlux-dialog-subtoolbar-filter",a.zluxdialog.toolbar.wrapper).slideToggle("fast"),t.toggleClass("zlux-ui-tool-enabled")}},{title:a._("REFRESH"),icon:"refresh",click:function(){a.reload()}}]),a.zluxdialog.newSubToolbar("filter","main")},initMainEvents:function(){var a=this;a.bind("InitComplete",function(){a.zluxdialog.scrollbar("refresh");var t=e(".zlux-dialog-subtoolbar-filter",a.zluxdialog.toolbar.wrapper);t.append(a.getSelect("aaApps",a._("IM_FILTER_BY_APP"),function(n){a.filter.apps=n,a.filter.types="",e(".btn-group[data-id=2]",t).attr("data-update",!0)},function(){a.filter.apps=""}),a.getSelect("aaTypes",a._("IM_FILTER_BY_TYPE"),function(n){a.filter.types=n,e(".btn-group[data-id=2]",t).attr("data-update",!1)},function(){a.filter.types=""}),a.getSelect("aaCategories",a._("IM_FILTER_BY_CATEGORY"),function(e){a.filter.cats=e},function(){a.filter.cats=""}),a.getSelect("aaTags",a._("IM_FILTER_BY_TAG"),function(e){a.filter.tags=e},function(){a.filter.tags=""})),e(".zlux-x-filter-input_wrapper",a.oTable.fnSettings().nTableWrapper).appendTo(t),a.zluxdialog.initContent()})},getSelect:function(a,t,n,l){var i=this,o=e.parseJSON(i.oTable.fnSettings().jqXHR.responseText)[a];if(o.length<=1)return"";var s=e('<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">'+t+'<span class="caret" /></a>'),r=e('<ul class="dropdown-menu">'+i._getSelectOptions(o)+"</ul>"),u=e('<div class="btn-group" data-text="'+t+'" />').append(s,r),d=e('<i class="icon-remove zlux-ui-dropdown-unselect" />').on("click",function(){s.html(t+'<span class="caret"></span>'),d.hide(),e.isFunction(l)&&l(),i.reload()}).hide().prependTo(u);return o.length||s.addClass("disabled"),s.on("click",function(){if(s.hasClass("disabled"))return""}),r.on("click","a",function(a){var l=e(this).data("value")?e(this).data("value"):"",o=t;o=e(this).text().replace(/^[^a-zA-Z]+/g,"").replace(/[^a-zA-Z]+$/g,""),d.show(),s.html(o+'<span class="caret"></span>').data("selected-value",l),e.isFunction(n)&&n(l),i.reload(),a.preventDefault()}),i.bind("TableDrawCallback",function(){var n=e.parseJSON(i.oTable.fnSettings().jqXHR.responseText)[a];r.empty().append(i._getSelectOptions(n)),n.length||u.addClass("disabled");var l=!1;e.each(n,function(e,a){a.id===s.data("selected-value")&&(l=!0)}),l||(d.hide(),s.data("selected-value","").html(t+'<span class="caret"></span>'))}),u},_getSelectOptions:function(e){var a,t=e.length,n=[];for(a=0;a<t;a++){var l='<li><a href="#" data-value="'+e[a].id+'">'+e[a].name+"</a></li>";jQuery.inArray(l,n)>-1||n.push(l)}return n.join("")}}),e.zlux[l.prototype.name]=l}(jQuery,window,document);