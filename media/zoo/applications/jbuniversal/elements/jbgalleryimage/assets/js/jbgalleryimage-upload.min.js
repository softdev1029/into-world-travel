/*
   http://www.gnu.org/licenses/gpl.html GNU/GPL
*/
(function(b){var g={init:function(a){b.extend({uploadId:"",url:"",maxNumberOfFiles:"",previewMaxWidth:"",previewMaxHeight:"",maxFileSize:"",imageMaxWidth:"",imageMaxHeight:"",deleteType:"simple",userId:"quest",trusted_mode:0},a);return this.each(function(){b("."+a.uploadId+"-galleryimage-fileupload").fileupload({dropZone:b("."+a.uploadId+" .galleryimage-dropzone"),url:a.url,dataType:"json",autoUpload:!0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:a.maxFileSize,loadImageMaxFileSize:a.maxFileSize,
maxChunkSize:4E6,maxNumberOfFiles:a.maxNumberOfFiles,getNumberOfFiles:function(){return b("."+a.uploadId+" .fl-files .fl-sort-images").length-1},disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator&&navigator.userAgent),previewMaxWidth:a.previewMaxWidth,previewMaxHeight:a.previewMaxHeight,previewCrop:!0,imageMaxWidth:a.imageMaxWidth,imageMaxHeight:a.imageMaxHeight,formData:{id:a.userId,elementId:a.uploadId}}).on("fileuploadadd",function(a,c){b(".fl-remove").remove();c.context=b('<li class="fl-sort-images uk-text-center"/>').appendTo(b(this).parents(".fl-galleryimage").find(".fl-files"));
b.each(c.files,function(a,h){b('<div class="uk-panel uk-panel-box" />').append(b('<div class="uk-panel-body"/>').append(b('<p class="uk-text-small uk-text-truncate uk-margin-small-top uk-margin-small-bottom"/>').html('<i class="fl-galleryimage-load-icon uk-icon-spinner uk-icon-spin"></i> '+h.name))).appendTo(c.context)})}).on("fileuploadprocessalways",function(g,c){var e=c.index,h=c.files[e],f=b(c.context.children()[e]);if(h.preview){var k=c.files[0].preview,k=b("<img/>").attr("src",k.toDataURL()).css({"max-width":a.previewMaxWidth+
"px","max-height":a.previewMaxHeight+"px"}),l=b('<div class="uk-panel-teaser"/>'),l=l.prepend(k);f.prepend(l)}h.error&&(b(this).parents(".fl-galleryimage").find(".fl-alert").removeClass("uk-hidden").append('<p class="uk-text-small uk-text-break">\u0424\u0430\u0439\u043b <b>'+h.name+"</b> \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d. \u041f\u0440\u0438\u0447\u0438\u043d\u0430: "+h.error+".</p>"),f.closest(".fl-sort-images").remove());e+1===c.files.length&&c.context.find("button").text("Upload").prop("disabled",
!!c.files.error)}).on("fileuploadprogressall",function(a,c){var e=parseInt(c.loaded/c.total*100,10);b(this).parents(".fl-galleryimage").find(".uk-progress").removeClass("uk-hidden").find(".uk-progress-bar").css("width",e+"%");100!=e?b("#fl-submit-button").prop("disabled",!0):b("#fl-submit-button").prop("disabled",!1)}).on("fileuploaddone",function(g,c){var e=b("."+a.uploadId+".fl-galleryimage-submission");b.each(c.result[a.uploadId+"-files"],function(h,f){if(f.url){var k=f.url,k=k.replace(location.protocol+
"//"+location.host+"/","").replace("//","/"),g="";b("."+a.uploadId+" .fl-files li");var d=parseInt(e.attr("fl-galleryimage-images")),m=b('<div class="fl-galleryimage-thumb uk-text-center">');a.trusted_mode&&(g='<div class="uk-button-group uk-margin-small-top uk-display-block"><a class="uk-button uk-button-mini" data-uk-toggle="{target:\'#'+a.uploadId+"-title-"+d+'\'}">\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435</a><a class="uk-button uk-button-mini" data-uk-toggle="{target:\'#'+a.uploadId+"-link-"+
d+'\'}">\u0421\u0441\u044b\u043b\u043a\u0430</a></div><div id="'+a.uploadId+"-title-"+d+'" class="uk-hidden"><div class="uk-margin-small-top"><input type="text" name="elements['+a.uploadId+"]["+d+'][title]" value="" class="uk-form-small" size="60" maxlength="255" title="\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435" placeholder="\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"></div></div><div id="'+a.uploadId+"-link-"+d+'" class="uk-hidden"><div class="uk-margin-small-top"><input type="text" name="elements['+
a.uploadId+"]["+d+'][link]" value="" class="uk-form-small uk-margin-small-top" size="60" maxlength="255" title="\u0421\u0441\u044b\u043b\u043a\u0430" placeholder="\u0421\u0441\u044b\u043b\u043a\u0430"></div><div class="uk-margin-small-top"><input type="text" name="elements['+a.uploadId+"]["+d+'][rel]" value="" class="uk-form-small uk-margin-small-top" size="60" maxlength="255" title="Rel" placeholder="Rel"></div><div class="uk-margin-small-top uk-text-small">\u0412 \u043d\u043e\u0432\u043e\u043c \u043e\u043a\u043d\u0435 <div class="controls"><label for="elements['+
a.uploadId+"]["+d+'][target]0" id="elements['+a.uploadId+"]["+d+'][target]0-lbl" class="radio"><input type="radio" name="elements['+a.uploadId+"]["+d+'][target]" id="elements['+a.uploadId+"]["+d+'][target]0" value="0" checked="checked" 0="">\u041d\u0435\u0442</label><label for="elements['+a.uploadId+"]["+d+'][target]1" id="elements['+a.uploadId+"]["+d+'][target]1-lbl" class="radio"><input type="radio" name="elements['+a.uploadId+"]["+d+'][target]" id="elements['+a.uploadId+"]["+d+'][target]1" value="1" 0="">\u0414\u0430</label></div></div></div>');
b(c.context.children()[h]).wrap(m).find(".uk-panel-body").addClass("uk-text-success").append('<a data-url="'+f.deleteUrl+'" class="fl-button-delete-'+a.deleteType+' uk-text-small">\u0423\u0434\u0430\u043b\u0438\u0442\u044c</a><input class="uk-hidden" name="elements['+a.uploadId+"]["+d+'][file]" type="text" value="'+k+'">'+g).find(".fl-galleryimage-load-icon").removeClass("uk-icon-spinner uk-icon-spin").addClass("uk-icon-check-circle-o");d++;e.attr("fl-galleryimage-images",d)}else f.error&&b(this).parents(".fl-galleryimage").find(".fl-alert").removeClass("uk-hidden").append('<p class="uk-text-small uk-text-break">\u0424\u0430\u0439\u043b <b>'+
f.name+"</b> \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d. \u041f\u0440\u0438\u0447\u0438\u043d\u0430: "+f.error+".</p>")})}).on("fileuploadfail",function(a,c){b.each(c.files,function(a){b(this).parents(".fl-galleryimage").find(".fl-alert").removeClass("uk-hidden").append('<p class="uk-text-small uk-text-break">\u0424\u0430\u0439\u043b <b>'+file.name+"</b> \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d.</p>")})}).prop("disabled",!b.support.fileInput).parent().addClass(b.support.fileInput?
void 0:"disabled")})},"delete":function(a){b.extend({url:"",uploadId:"",methodType:"DELETE",userId:""},a);return this.each(function(){b.ajax({type:a.methodType,url:a.url+"&id="+a.userId+"&elementId="+a.uploadId,success:function(b){g.updateImageCount(a.uploadId)}})})},updateImageCount:function(a){0==b("."+a+" .fl-sort-images").length&&b("."+a+" .uk-progress").addClass("uk-hidden")}};b.fn.jbGalleryImageUpload=function(a){if(g[a])return g[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==
typeof a&&a)b.error("\u041c\u0435\u0442\u043e\u0434 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "+a+" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0434\u043b\u044f jbGalleryImageUpload");else return g.init.apply(this,arguments)}})(jQuery);