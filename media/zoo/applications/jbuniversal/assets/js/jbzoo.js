;(function($,window,document,undefined){var globalAjaxId=0;JBZoo.widget('JBZoo',{},{jbzoo:window.JBZoo,_isAjax:false,_isAjaxLocking:false,_onAjaxStart:function(options){var $target=(options.target)?$(options.target):this.el;$target.addClass('jbloading');},_onAjaxStop:function(options,args){var $target=(options.target)?$(options.target):this.el;$target.removeClass('jbloading');},ajax:function(options){var $this=this;globalAjaxId++;if($this._isAjaxLocking&&$this._isAjax){JBZoo.logger('i','ajax::'+globalAjaxId+' locked!');return $this;}
$this._isAjax=true;$.isFunction($this._onAjaxStart)&&$this._onAjaxStart.apply($this,[options]);var options=$.extend(true,{},{'url':'index.php?format=raw&tmpl=component','data':{'rand':JBZoo.rand(100,999),'option':'com_zoo','tmpl':'component','format':'raw'},'target':false,'dataType':'json','success':$.noop,'error':$.noop,'onFatal':function(responce){if(JBZoo.DEBUG){JBZoo.logger('e','ajax('+globalAjaxId+') ->',responce[0].responseText);}else{$this.error('ajax('+globalAjaxId+') response no parse');}}},options);if(JBZoo.empty(options.url)){$this._isAjax=false;$.isFunction($this._onAjaxStop)&&$this._onAjaxStop.apply($this,[options]);$this.error("ajax("+globalAjaxId+") url is no set!");return;}
$.ajax({'url':options.url,'data':options.data,'dataType':options.dataType,'type':'POST','cache':false,'headers':{"cache-control":"no-cache"},'success':function(data){$this._isAjax=false;if(typeof data=='string'){data=$.trim(data);}
if(options.dataType=='json'){if(data.result&&$.isFunction(options.success)){options.success.apply($this,arguments);}else if(!data.result&&$.isFunction(options.error)){options.error.apply($this,arguments);}}else if($.isFunction(options.success)){options.success.apply($this,arguments);}
$.isFunction($this._onAjaxStop)&&$this._onAjaxStop.apply($this,[options,arguments]);},'error':function(){$this._isAjax=false;$.isFunction($this._onAjaxStop)&&$this._onAjaxStop.apply($this,[options,arguments]);options.onFatal(arguments);}});},data:function(key,selector){if(selector){return this.$(selector).data(key);}
return this.el.data(key);},attr:function(attr,selector){if(selector){return this.$(selector).attr(attr);}
return this.el.attr(attr);},error:function(message){return JBZoo.error(this._name+': '+message);},alert:function(message,closeCallback,params){var $this=this,_swal=$.isFunction(window.parent.swal)?window.parent.swal:swal;if($.isFunction(_swal)){params=$.extend(true,{},{html:true,title:message,allowOutsideClick:true,confirmButtonText:JBZoo.getVar('JBZOO_DIALOGBOX_OK','OK')},$this._def(params,{}));_swal(params,closeCallback);}else{message=JBZoo.stripTags(message);alert(message);closeCallback()}},confirm:function(message,yesCallback,noCallback,context){var $this=this,_swal=$.isFunction(window.parent.swal)?window.parent.swal:swal;noCallback=noCallback||$.noop;yesCallback=yesCallback||$.noop;if($.isFunction(_swal)){_swal({html:true,title:message,showCancelButton:true,closeOnConfirm:true,closeOnCancel:true,allowOutsideClick:false,confirmButtonText:JBZoo.getVar('JBZOO_DIALOGBOX_OK','OK'),cancelButtonText:JBZoo.getVar('JBZOO_DIALOGBOX_CANCEL','Cancel')},function(isConfirm){if(isConfirm){if($.isFunction(yesCallback)){yesCallback.apply(context)}}else{if($.isFunction(noCallback)){noCallback.apply(context)}}});}else{message=JBZoo.stripTags(message);if(confirm(message)){$.isFunction(yesCallback)&&yesCallback.apply(context);}else{$.isFunction(noCallback)&&noCallback.apply(context);}}},setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},setOption:function(key,value){this.options[key]=value;return this;},getOption:function(key){return this.options[key];},getOptions:function(){return this.options;},_:function(key){return key;},_def:function(value,defaultValue){return typeof value!=='undefined'?value:defaultValue;},setCookie:function(key,value,namespace){if(!JBZoo.isWidgetExists('cookie')){return;}
var $this=this,ns=$this._def(namespace,$this._name);$.cookie(ns+'_'+key,value,{'path':'/','expires':365});},getCookie:function(key,defaultVal,namespace){if(!JBZoo.isWidgetExists('cookie')){return;}
var $this=this,ns=$this._def(namespace,$this._name),cookieKey=$.cookie(ns+'_'+key);return this._def(cookieKey,defaultVal);},_key:function(event,keyName){var key=event.which,map={'enter':[13],'arrow-left':[37],'arrow-top':[38],'arrow-right':[39],'arrow-down':[40]};keyName=$.trim(keyName.toLowerCase());return JBZoo.in_array(key,map[keyName]);}});})(jQuery,window,document);