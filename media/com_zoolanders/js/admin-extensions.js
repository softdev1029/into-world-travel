/**
 * @package     ZOOlanders
 * @version     3.3.15
 * @author      ZOOlanders - http://zoolanders.com
 * @license     GNU General Public License v2 or later
 */

!function(t,a,n){"use strict";a.component("zoolandersExtensions",{overlay:null,init:function(){var t=this;t.overlay=a.zoolandersOverlay(t.element,{content:a.lang.get("ZL_MSG_CONNECTING")}),t.initActions(),t.initModal(),t.options.autoload&&t.reloadList(!0)},initActions:function(){var n=this;t("#zl_options_reset").on("click",function(a){a.preventDefault(),a.stopPropagation();var n=t(this).parent();n&&t("input",n).val("")}),t("#toolbar-reload button").on("click",function(){n.reloadList(!0)}),n.element.on("click",".zx-x-install",function(n){var o=t(this),e=o.closest("tr"),l=t(".zx-x-uninstall",e);""!==e.data("ext").url&&(n.preventDefault(),o.zx("spin"),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"downloadandinstall"}),data:{extensions:[e.data("ext")]}}).done(function(n){var i=a.lang.sprintf("ZL_TIP_REINSTALL",n.ext.title,n.ext.version);o.data("tooltip")?o.data("tooltip").tip=i:o.attr("title",i),t("i",o).attr("class","uk-icon-retweet"),t(".zx-x-version",e).html('<span class="uk-badge uk-badge-notification uk-badge-success">'+n.ext.version+"</span>");var s=t('<a href="#" data-uk-tooltip />');"extension"==n.ext.type&&(1==n.ext.enabled?(s.attr("title",a.lang._("ZL_TIP_STATUS_ENABLED")),s.html('<i class="uk-icon-check"></i>')):(s.attr("title",a.lang._("ZL_TIP_STATUS_DISABLED")),s.html('<i class="uk-icon-times"></i>')),t(".zx-x-status",e).html(s)),l.removeAttr("disabled")}).always(function(){o.zx("spin.off")}))}),n.element.on("click",".zx-x-uninstall",function(n){n.preventDefault();var o=t(this),e=o.closest("tr"),l=t(".zx-x-install",e);a.notify.closeAll(),a.notify.confirm(a.lang.sprintf("ZL_MSG_CONFIRM_REMOVAL",e.data("ext").title),{status:"warning",timeout:0}).done(function(){o.zx("spin"),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"uninstall"}),data:{name:e.data("ext").name}}).done(function(n){if(n.ext.deprecated)e.remove();else{o.prop("disabled",!0);var i=a.lang.sprintf("ZL_TIP_INSTALL",n.ext.title,n.ext.version);l.data("tooltip")?l.data("tooltip").tip=i:l.attr("title",i),t("i",l).attr("class","uk-icon-bolt"),t(".zx-x-version",e).html("---"),t(".zx-x-status",e).html("---")}}).always(function(){o.zx("spin.off")})})}),t(".zx-x-updateall",n.element).on("click",function(n){n.preventDefault();var o=[];t("tr[data-ext]").each(function(a,n){"outdated"===t(n).data("ext").state&&o.push(t(n).data("ext"))}),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"downloadandinstall"}),data:{extensions:o}})}),n.element.on("click",".zx-x-download",function(n){n.preventDefault();var o=t(this),e=o.closest("tr");o.zx("spin"),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"downloadAndZip"}),data:{extensions:[e.data("ext")]}}).done(function(t){t.filepath&&(window.location.href=a.url.get("ajax:",{controller:"zoolanders",task:"outputFile",file:t.filepath}))}).always(function(){o.zx("spin.off")})}),t("#toolbar-download button").on("click",function(n){n.preventDefault();var o=a.notify(a.lang.get("ZL_MSG_DOWNLOAD_ALL_START")+' <i class="uk-icon-zx-spinner uk-icon-spin"></i>',{timeout:null,group:"downloadall"}),e=[];t("tr[data-ext]").each(function(a,n){e.push(t(n).data("ext"))}),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"downloadAndZip"}),data:{extensions:e}}).done(function(t){if(t.filepath){var n=a.url.get("ajax:",{controller:"zoolanders",task:"outputFile",file:t.filepath});o.status("success").content(a.lang.sprintf("ZL_MSG_DOWNLOAD_ALL_SUCCESS",n))}}).fail(function(){o.close(!0)})}),t("#toolbar-langpacks button").on("click",function(n){n.preventDefault();var o=t(this),e=(o.closest("tr"),a.modal.dialog('<div class="uk-text-center"><i class="uk-icon-zx-spinner uk-icon-spin uk-icon-large uk-margin-large-bottom uk-margin-large-top"></i></div>').show());a.ajax.request({url:a.url.get("ajax:",{controller:"zoolanders",task:"getLangList"})}).done(function(t){t.html&&e.content('<a class="uk-modal-close uk-close"></a>'+t.html)}).fail(function(a){var n=[];a.errors&&a.errors.length&&t.each(a.errors,function(){n.push(this)}),a.notices&&a.notices.length&&t.each(a.notices,function(){n.push(this)}),e.content(n.join("<br />"))})}),t("body").on("click",".zx-x-download-lang-packs",function(n){n.preventDefault();var o=t(this);o.zx("spin"),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"downloadLangInstaller"}),data:{language:o.closest("li").data("lang-code")}}).done(function(t){t.filepath&&(window.location.href=a.url.get("ajax:",{controller:"zoolanders",task:"outputFile",file:t.filepath}))}).always(function(){o.zx("spin.off")})}),t("body").on("click",".zx-x-install-lang-packs",function(n){n.preventDefault();var o=t(this);o.zx("spin"),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"installLangPack"}),data:{language:o.closest("li").data("lang-code")}}).done(function(t){a.notify(a.lang.sprintf("ZL_MSG_LANG_PACK_INSTALLED","ZOOlanders",o.closest("li").data("lang-name")),{status:"success"})}).always(function(){o.zx("spin.off")})}),n.element.on("click",".zx-x-resource-lang-packs",function(n){n.preventDefault();var o=t(this),e=o.closest("tr"),l=a.modal.dialog('<div class="uk-text-center"><i class="uk-icon-zx-spinner uk-icon-spin uk-icon-large uk-margin-large-bottom uk-margin-large-top"></i></div>').show();a.ajax.request({url:a.url.get("ajax:",{controller:"zoolanders",task:"getResourceLangList"}),data:{title:e.data("ext").title}}).done(function(t){t.html&&l.content('<a class="uk-modal-close uk-close"></a>'+t.html)}).fail(function(a){var n=[];a.errors&&a.errors.length&&t.each(a.errors,function(){n.push(this)}),a.notices&&a.notices.length&&t.each(a.notices,function(){n.push(this)}),l.content(n.join("<br />"))})}),t("body").on("click",".zx-x-download-resource-lang-pack",function(n){n.preventDefault();var o=t(this);o.zx("spin"),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"downloadLangInstaller"}),data:{resources:[o.closest("ul").data("resource")],language:o.closest("li").data("lang-code")}}).done(function(t){t.filepath&&(window.location.href=a.url.get("ajax:",{controller:"zoolanders",task:"outputFile",file:t.filepath}))}).always(function(){o.zx("spin.off")})}),t("body").on("click",".zx-x-install-resource-lang-pack",function(n){n.preventDefault();var o=t(this);o.zx("spin"),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"installLangPack"}),data:{resources:[o.closest("ul").data("resource")],language:o.closest("li").data("lang-code")}}).done(function(t){a.notify(a.lang.sprintf("ZL_MSG_LANG_PACK_INSTALLED",o.closest("ul").data("resource"),o.closest("li").data("lang-name")),{status:"success"})}).always(function(){o.zx("spin.off")})}),n.element.on("click",".zx-x-status",function(n){n.preventDefault();var o=t(this),e=o.closest("tr");o.zx("spin"),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"toggleExtState"}),data:{name:e.data("ext").name},type:"POST"},{group:"statetoggle"}).always(function(t){o.zx("spin.off"),void 0!==t.new_state&&(1==t.new_state?(o.data("tooltip").tip=a.lang._("ZL_TIP_STATUS_ENABLED"),o.html('<i class="uk-icon-check"></i>')):(o.data("tooltip").tip=a.lang._("ZL_TIP_STATUS_DISABLED"),o.html('<i class="uk-icon-times"></i>')))})})},initModal:function(){var o=this,e=t("#zl-modal-options").detach();t("form",e).on("submit",function(n){n.preventDefault();var e=t(this);t(".uk-button",e).zx("spin"),a.ajax.requestAndNotify({url:e.attr("action")+"&format=raw",type:e.attr("method"),data:e.serializeArray()}).done(function(t){o.modal.hide(),location.reload()}).always(function(a){t(".uk-button",e).zx("spin.off")})}),t("#toolbar-options button").on("click",function(){o.modal=n.modal.dialog(e.children()),t(".uk-modal-dialog",o.modal.element).prepend('<a class="uk-modal-close uk-close"></a>'),o.modal.element.wrap(t('<div class="zx" />')),o.modal.show()})},reloadList:function(n){var o=this;o.overlay.cover(),a.ajax.requestAndNotify({url:a.url.get("ajax:",{controller:"zoolanders",task:"loadList",format:"raw"}),data:{force:n}}).done(function(a){a&&a.success&&a.html&&t("#zl_list_container").html(a.html)}).always(function(){o.overlay.uncover()})}})}(jQuery,zlux,UIkit);